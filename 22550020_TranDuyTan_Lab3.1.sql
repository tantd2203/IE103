CREATE DATABASE QUANLYDETAI

USE QUANLYDETAI

CREATE TABLE SINHVIEN (
	MSSV CHAR(8) PRIMARY KEY,
	TENSV NVARCHAR(30) NOT NULL,
	SODT VARCHAR(10),
	LOP CHAR(10) NOT NULL,
	DIACHI NCHAR(50) NOT NULL,
)

CREATE TABLE DETAI (
	MSDT CHAR(6) PRIMARY KEY,
	TENDT NVARCHAR(30) NOT NULL
)

CREATE TABLE SV_DETAI (
	MSSV CHAR(8),
	MSDT CHAR(6)
)

ALTER TABLE SV_DETAI ADD CONSTRAINT FK_SV_DETAI_MSSV FOREIGN KEY(MSSV) REFERENCES SINHVIEN(MSSV)
ALTER TABLE SV_DETAI ADD CONSTRAINT FK_SV_DETAI_MSDT FOREIGN KEY(MSDT) REFERENCES DETAI(MSDT)

CREATE TABLE HOCVI (
	MSHV INT PRIMARY KEY,
	TENHV NVARCHAR(20) NOT NULL
)

CREATE TABLE HOCHAM (
	MSHH INT PRIMARY KEY,
	TENHH NVARCHAR(20) NOT NULL
)

CREATE TABLE GIAOVIEN (
	MSGV CHAR(5) PRIMARY KEY,
	TENGV NVARCHAR(30) NOT NULL,
	DIACHI NVARCHAR(50) NOT NULL,
	SODT VARCHAR(10) NOT NULL,
	MSHH INT,
	NAMHH SMALLDATETIME NOT NULL,
)

ALTER TABLE GIAOVIEN ADD CONSTRAINT FK_GIAOVIEN_MSDT FOREIGN KEY(MSHH) REFERENCES HOCHAM(MSHH)

CREATE TABLE CHUYENNGANH (
	MSCN INT PRIMARY KEY,
	TENCN NVARCHAR(30) NOT NULL
)

CREATE TABLE GV_HV_CN (
	MSGV CHAR(5),
	MSHV INT,
	MSCN INT,
	NAM SMALLDATETIME NOT NULL,
	PRIMARY KEY(MSGV, MSHV, MSCN)
)

ALTER TABLE GV_HV_CN ADD CONSTRAINT FK_GV_HV_CN_MSGV FOREIGN KEY(MSGV) REFERENCES GIAOVIEN(MSGV)
ALTER TABLE GV_HV_CN ADD CONSTRAINT FK_GV_HV_CN_MSHV FOREIGN KEY(MSHV) REFERENCES HOCVI(MSHV)
ALTER TABLE GV_HV_CN ADD CONSTRAINT FK_GV_HV_CN_MSCN FOREIGN KEY(MSCN) REFERENCES CHUYENNGANH(MSCN)

CREATE TABLE GV_HDDT (
	MSGV CHAR(5),
	MSDT CHAR(6),
	DIEM FLOAT NOT NULL,
	PRIMARY KEY(MSGV, MSDT)
)

ALTER TABLE GV_HDDT ADD CONSTRAINT FK_GV_HDDT_MSGV FOREIGN KEY(MSGV) REFERENCES GIAOVIEN(MSGV)
ALTER TABLE GV_HDDT ADD CONSTRAINT FK_GV_HDDT_MSDT FOREIGN KEY(MSDT) REFERENCES DETAI(MSDT)

CREATE TABLE GV_PBDT (
	MSGV CHAR(5),
	MSDT CHAR(6),
	DIEM FLOAT NOT NULL,
	PRIMARY KEY(MSGV, MSDT)
)

ALTER TABLE GV_PBDT ADD CONSTRAINT FK_GV_PBDT_MSGV FOREIGN KEY(MSGV) REFERENCES GIAOVIEN(MSGV)
ALTER TABLE GV_PBDT ADD CONSTRAINT FK_GV_PBDT_MSDT FOREIGN KEY(MSDT) REFERENCES DETAI(MSDT)

CREATE TABLE GV_UVDT (
	MSGV CHAR(5),
	MSDT CHAR(6),
	DIEM FLOAT NOT NULL,
	PRIMARY KEY(MSGV, MSDT)
)

ALTER TABLE GV_UVDT ADD CONSTRAINT FK_GV_UVDT_MSGV FOREIGN KEY(MSGV) REFERENCES GIAOVIEN(MSGV)
ALTER TABLE GV_UVDT ADD CONSTRAINT FK_GV_UVDT_MSDT FOREIGN KEY(MSDT) REFERENCES DETAI(MSDT)

CREATE TABLE HOIDONG (
	MSHD INT PRIMARY KEY,
	PHONG CHAR(3),
	TGBD SMALLDATETIME,
	NGAYHD SMALLDATETIME NOT NULL,
	TINHTRANG NVARCHAR(30) NOT NULL,
	MSGV CHAR(5)
)

ALTER TABLE HOIDONG ADD CONSTRAINT FK_HOIDONG_MSGV FOREIGN KEY(MSGV) REFERENCES GIAOVIEN(MSGV)

CREATE TABLE HOIDONG_GV (
	MSHD INT,
	MSGV CHAR(5),
	PRIMARY KEY(MSHD, MSGV)
)

ALTER TABLE HOIDONG_GV ADD CONSTRAINT FK_HOIDONG_GV_MSHD FOREIGN KEY(MSHD) REFERENCES HOIDONG(MSHD)
ALTER TABLE HOIDONG_GV ADD CONSTRAINT FK_HOIDONG_GV_MSGV FOREIGN KEY(MSGV) REFERENCES GIAOVIEN(MSGV)

CREATE TABLE HOIDONG_DT (
	MSHD INT,
	MSDT CHAR (6),
	QUYETDINH NCHAR(10),
	PRIMARY KEY(MSHD, MSDT)
)

ALTER TABLE HOIDONG_DT ADD CONSTRAINT FK_HOIDONG_DT_MSHD FOREIGN KEY(MSHD) REFERENCES HOIDONG(MSHD)
ALTER TABLE HOIDONG_DT ADD CONSTRAINT FK_HOIDONG_DT_MSDT FOREIGN KEY(MSDT) REFERENCES DETAI(MSDT)


INSERT INTO SINHVIEN (MSSV, TENSV,  SODT, LOP, DIACHI) VALUES ('13520001',N'Nguyễn Văn An','906762255','SE103.U32',N'THỦ ĐỨC')
INSERT INTO SINHVIEN (MSSV, TENSV,  SODT, LOP, DIACHI) VALUES ('13520002',N'Phan Tấn Đạt','975672350','IE204.T21',N'QUẬN 1')
INSERT INTO SINHVIEN (MSSV, TENSV,  SODT, LOP, DIACHI) VALUES ('13520003',N'Nguyễn Anh Hải','947578688','IE205.R12',N'QUẬN 9')
INSERT INTO SINHVIEN (MSSV, TENSV,  SODT, LOP, DIACHI) VALUES ('13520004',N'Phạm Tài','956757869','IE202.A22',N'QUẬN 1')
INSERT INTO SINHVIEN (MSSV, TENSV,  SODT, LOP, DIACHI) VALUES ('13520005',N'Lê Thúy Hằng','976668688','SE304.E22',N'THỦ ĐỨC')
INSERT INTO SINHVIEN (MSSV, TENSV,  SODT, LOP, DIACHI) VALUES ('13520006',N'Ưng Hồng Ân','957475898','IE208.F33',N'QUẬN 2')


INSERT INTO DETAI (MSDT, TENDT) VALUES ('97001',N'Quản lý thư viện')
INSERT INTO DETAI (MSDT, TENDT) VALUES ('97002',N'Nhận dạng vân tay')
INSERT INTO DETAI (MSDT, TENDT) VALUES ('97003',N'Bán đấu giá trên mạng')
INSERT INTO DETAI (MSDT, TENDT) VALUES ('97004',N'Quản lý siêu thị')
INSERT INTO DETAI (MSDT, TENDT) VALUES ('97005',N'Xử lý ảnh')
INSERT INTO DETAI (MSDT, TENDT) VALUES ('97006',N'Hệ giải toán thông minh')


INSERT INTO SV_DETAI (MSSV, MSDT) VALUES ('13520001','97004')
INSERT INTO SV_DETAI (MSSV, MSDT) VALUES ('13520002','97005')
INSERT INTO SV_DETAI (MSSV, MSDT) VALUES ('13520003','97001')
INSERT INTO SV_DETAI (MSSV, MSDT) VALUES ('13520004','97002')
INSERT INTO SV_DETAI (MSSV, MSDT) VALUES ('13520005','97003')
INSERT INTO SV_DETAI (MSSV, MSDT) VALUES ('13520006','97005')


INSERT INTO HOCHAM (MSHH, TENHH) VALUES ('1',N'PHÓ GIÁO SƯ')
INSERT INTO HOCHAM (MSHH, TENHH) VALUES ('2',N'GIÁO SƯ')


INSERT INTO GIAOVIEN (MSGV, TENGV, DIACHI, SODT, MSHH, NAMHH) VALUES ('00201',N'Trần Trung',N'Bến Tre','35353535','1','2020')
INSERT INTO GIAOVIEN (MSGV, TENGV, DIACHI, SODT, MSHH, NAMHH) VALUES ('00202',N'Nguyễn Văn An',N'Tiền Giang','67868688','1','2016')
INSERT INTO GIAOVIEN (MSGV, TENGV, DIACHI, SODT, MSHH, NAMHH) VALUES ('00203',N'Trần Thu Trang',N'Cần Thơ','74758687','1','2019')
INSERT INTO GIAOVIEN (MSGV, TENGV, DIACHI, SODT, MSHH, NAMHH) VALUES ('00204',N'Nguyễn Thị Loan',N'TP. HCM','56575868','2','2021')
INSERT INTO GIAOVIEN (MSGV, TENGV, DIACHI, SODT, MSHH, NAMHH) VALUES ('00205',N'Chu Tiến',N'Hà Nội','46466646','2','2022')


INSERT INTO HOCVI(MSHV, TENHV) VALUES ('1',N'Kỹ sư')
INSERT INTO HOCVI(MSHV, TENHV) VALUES ('2',N'Cử nhân')
INSERT INTO HOCVI(MSHV, TENHV) VALUES ('3',N'Thạc sĩ')
INSERT INTO HOCVI(MSHV, TENHV) VALUES ('4',N'Tiến sĩ')
INSERT INTO HOCVI(MSHV, TENHV) VALUES ('5',N'Tiến sĩ Khoa học')


INSERT INTO CHUYENNGANH (MSCN, TENCN) VALUES ('1',N'Công nghệ Web')
INSERT INTO CHUYENNGANH (MSCN, TENCN) VALUES ('2',N'Mạng xã hội')
INSERT INTO CHUYENNGANH (MSCN, TENCN) VALUES ('3',N'Quản lý CNTT')
INSERT INTO CHUYENNGANH (MSCN, TENCN) VALUES ('4',N'GIS')


INSERT INTO GV_HV_CN (MSGV,MSHV,MSCN,NAM) VALUES ('00201','1','1','2013')
INSERT INTO GV_HV_CN (MSGV,MSHV,MSCN,NAM) VALUES ('00201','1','2','2013')
INSERT INTO GV_HV_CN (MSGV,MSHV,MSCN,NAM) VALUES ('00201','2','1','2014')
INSERT INTO GV_HV_CN (MSGV,MSHV,MSCN,NAM) VALUES ('00202','3','2','2013')
INSERT INTO GV_HV_CN (MSGV,MSHV,MSCN,NAM) VALUES ('00203','2','4','2014')
INSERT INTO GV_HV_CN (MSGV,MSHV,MSCN,NAM) VALUES ('00204','3','2','2014')


INSERT INTO GV_HDDT(MSGV, MSDT,DIEM) VALUES ('00201','97001','8')
INSERT INTO GV_HDDT(MSGV, MSDT,DIEM) VALUES ('00202','97002','7')
INSERT INTO GV_HDDT(MSGV, MSDT,DIEM) VALUES ('00205','97001','9')
INSERT INTO GV_HDDT(MSGV, MSDT,DIEM) VALUES ('00204','97004','7')
INSERT INTO GV_HDDT(MSGV, MSDT,DIEM) VALUES ('00203','97005','9')


INSERT INTO GV_PBDT(MSGV, MSDT,DIEM) VALUES ('00201','97005','8')
INSERT INTO GV_PBDT(MSGV, MSDT,DIEM) VALUES ('00202','97001','7')
INSERT INTO GV_PBDT(MSGV, MSDT,DIEM) VALUES ('00205','97004','9')
INSERT INTO GV_PBDT(MSGV, MSDT,DIEM) VALUES ('00204','97003','7')
INSERT INTO GV_PBDT(MSGV, MSDT,DIEM) VALUES ('00203','97002','9')


INSERT INTO GV_UVDT(MSGV, MSDT,DIEM) VALUES ('00205','97005','8')
INSERT INTO GV_UVDT(MSGV, MSDT,DIEM) VALUES ('00202','97005','7')
INSERT INTO GV_UVDT(MSGV, MSDT,DIEM) VALUES ('00204','97005','9')
INSERT INTO GV_UVDT(MSGV, MSDT,DIEM) VALUES ('00203','97001','7')
INSERT INTO GV_UVDT(MSGV, MSDT,DIEM) VALUES ('00204','97001','9')
INSERT INTO GV_UVDT(MSGV, MSDT,DIEM) VALUES ('00205','97001','8')
INSERT INTO GV_UVDT(MSGV, MSDT,DIEM) VALUES ('00203','97003','7')
INSERT INTO GV_UVDT(MSGV, MSDT,DIEM) VALUES ('00201','97003','9')
INSERT INTO GV_UVDT(MSGV, MSDT,DIEM) VALUES ('00202','97003','7')
INSERT INTO GV_UVDT(MSGV, MSDT,DIEM) VALUES ('00201','97004','9')
INSERT INTO GV_UVDT(MSGV, MSDT,DIEM) VALUES ('00202','97004','8')
INSERT INTO GV_UVDT(MSGV, MSDT,DIEM) VALUES ('00203','97004','7')
INSERT INTO GV_UVDT(MSGV, MSDT,DIEM) VALUES ('00201','97002','9')
INSERT INTO GV_UVDT(MSGV, MSDT,DIEM) VALUES ('00204','97002','7')
INSERT INTO GV_UVDT(MSGV, MSDT,DIEM) VALUES ('00205','97002','9')
INSERT INTO GV_UVDT(MSGV, MSDT,DIEM) VALUES ('00201','97006','9')
INSERT INTO GV_UVDT(MSGV, MSDT,DIEM) VALUES ('00202','97006','7')
INSERT INTO GV_UVDT(MSGV, MSDT,DIEM) VALUES ('00204','97006','9')


SET DATEFORMAT DMY;
INSERT INTO HOIDONG(MSHD, PHONG, TGBD, NGAYHD, TINHTRANG, MSGV) VALUES ('1','002','7:00','29/11/2014',N'Thật','00201')
INSERT INTO HOIDONG(MSHD, PHONG, TGBD, NGAYHD, TINHTRANG, MSGV) VALUES ('2','102','7:00','05/12/2014',N'Thật','00202')
INSERT INTO HOIDONG(MSHD, PHONG, TGBD, NGAYHD, TINHTRANG, MSGV) VALUES ('3','003','8:00','06/12/2014',N'Thật','00203')


INSERT INTO HOIDONG_GV(MSHD, MSGV) VALUES ('1','00201')
INSERT INTO HOIDONG_GV(MSHD, MSGV) VALUES ('1','00202')
INSERT INTO HOIDONG_GV(MSHD, MSGV) VALUES ('1','00203')
INSERT INTO HOIDONG_GV(MSHD, MSGV) VALUES ('1','00204')
INSERT INTO HOIDONG_GV(MSHD, MSGV) VALUES ('2','00203')
INSERT INTO HOIDONG_GV(MSHD, MSGV) VALUES ('2','00202')
INSERT INTO HOIDONG_GV(MSHD, MSGV) VALUES ('2','00205')
INSERT INTO HOIDONG_GV(MSHD, MSGV) VALUES ('2','00204')
INSERT INTO HOIDONG_GV(MSHD, MSGV) VALUES ('3','00201')
INSERT INTO HOIDONG_GV(MSHD, MSGV) VALUES ('3','00202')
INSERT INTO HOIDONG_GV(MSHD, MSGV) VALUES ('3','00203')
INSERT INTO HOIDONG_GV(MSHD, MSGV) VALUES ('3','00204')


INSERT INTO HOIDONG_DT(MSHD, MSDT, QUYETDINH) VALUES ('1','97001',N'Được')
INSERT INTO HOIDONG_DT(MSHD, MSDT, QUYETDINH) VALUES ('1','97002',N'Được')
INSERT INTO HOIDONG_DT(MSHD, MSDT, QUYETDINH) VALUES ('2','97001',N'Không')
INSERT INTO HOIDONG_DT(MSHD, MSDT, QUYETDINH) VALUES ('2','97004',N'Không')
INSERT INTO HOIDONG_DT(MSHD, MSDT, QUYETDINH) VALUES ('1','97005',N'Được')
INSERT INTO HOIDONG_DT(MSHD, MSDT, QUYETDINH) VALUES ('3','97001',N'Không')
INSERT INTO HOIDONG_DT(MSHD, MSDT, QUYETDINH) VALUES ('3','97002',N'Được')


--d. Thực hiện các truy vấn sau bằng ngôn ngữ SQL:
--d1. Cho biết danh sách giáo viên gồm MSGV, TENGV, DIACHI, SODT, TENHH.
SELECT MSGV, TENGV, DIACHI, SODT,hh.TENHH
FROM GIAOVIEN  gv
JOIN HOCHAM hh ON hh.MSHH = gv.MSHH


--d2. Cho biết số lượng sinh viên sống ở ‘QUẬN 1’ (DIACHI).
SELECT COUNT(*) as SL_SV 
FROM SINHVIEN as sv
WHERE DIACHI = N'QUẬN 1'



--d3. Với những sinh viên tham gia lớp có mã lớp (LOP) bắt đầu bằng ký hiệu ‘IE’, liệt kê MSSV, TENSV và mã lớp (LOP) mà sinh viên đó tham gia.
SELECT sv.TENSV, sv.TENSV, sv.LOP
FROM SINHVIEN as sv
WHERE sv.LOP like 'IE%'



--d4. Liệt kê danh sách đề tài (MSDT, TENDT) và tên giáo viên hướng dẫn (TENGV) tương ứng, sắp xếp theo mã số đề tài tăng dần.
SELECT dt.MSDT, TENDT ,TENGV
FROM DETAI dt
JOIN GV_HDDT gv_hd ON gv_hd.MSDT =   dt.MSDT
JOin GIAOVIEN gv ON gv.MSGV = gv_hd.MSGV
ORDER BY dt.MSDT



--d5. Cho biết số lượng đề tài (SLDT) đã hướng dẫn ứng với từng giáo viên (TENGV).
SELECT COUNT(MSDT)  SLDT, TENGV
FROM  GIAOVIEN GV, GV_HDDT HD
WHERE GV.MSGV = HD.MSGV
GROUP BY TENGV



--d6. Liệt kê danh sách giáo viên (MSGV, TENGV) chưa hướng dẫn đề tài nào

SELECT  MSGV , TENGV
FROM GIAOVIEN
WHERE MSGV NOT IN (SELECT  MSGV 
                      FROM GV_HDDT)

--a Khai báo biến a có kiểu dữ liệu int với giá trị khởi tạo là 100, sau đó in ra giá trị của biến a
DECLARE @a int = 100;
PRINT @a


--b. Khai báo biến TenTruong có kiểu dữ liệu nvarchar(100) với giá trị khởi tạo là ‘Trường Đại học Công nghệ thông tin’, sau đó in ra giá trị của biến TenTruong.
DECLARE @TenTruong nvarchar(100) = N'Trường Đại học Công nghệ thông tin'
PRINT @TenTruong


--c. Khai báo biến a1 và biến a2 có kiểu dữ liệu float với giá trị khởi tạo lần lượt là 2.0 và 3.0, sau đó in ra kết quả của phép cộng a1 + a2 (kq) theo định dạng: a1 + a2 = kq.
DECLARE @a1 float = 2.0 , @a2  float  = 3.0 
DECLARE @a3 float = @a1 +@a2
PRINT 'a1  + a2 =' + CAST (@a3  as varchar(4))


--d. Khai báo biến phrase1 và biến phrase2 có kiểu dữ liệu nvarchar(10) với giá trị khởi tạo lần lượt là ‘Xin chào’ và ‘Việt Nam’, sau đó gán lại giá trị của phrase1 là ‘Tạm biệt’, phrase2 là ‘lớp học’
--và in ra giá trị của hai biến trên.


DECLARE @phrase1 NVARCHAR(10) = N'Xin chào' 
,@phrase2 NVARCHAR(10) = N'Việt Nam'
SET @phrase1 = N'Tạm biệt'
SET @phrase2 = N'lớp học'
PRINT @phrase1
PRINT @phrase2


--Bài tập 2. Cấu trúc lựa chọn IF… ELSE…
--a. Khai báo biến result có kiểu dữ liệu float với giá trị khởi tạo là kết quả của phép toán 15 + 10 - 5 * 5 / 5. Thiết kế cấu trúc lựa chọn có điều kiện kiểm tra là result > 15, nếu đúng thì in ra chuỗi
--‘result > 15’, ngược lại thì in ra chuỗi ‘result <= 15’.
DECLARE @result float = 15 + 10 - 5 * 5 / 5
IF @result > 15
PRINT  'result > 15'
ELSE 
PRINT  'result <= 15'

--b. Giải phương trình bậc nhất một ẩn:
--b1. Sử dụng cấu trúc lựa chọn if… else… để giải phương trình bậc nhất một ẩn 𝑎𝑥 + 𝑏 = 0 với hệ số nguyên (Khai báo các biến 𝑎, 𝑏 tương ứng với các hệ số của phương trình).
--b2. Lùi lên trên đoạn code giải phương trình, gán giá trị cho các biến 𝑎 = 2, 𝑏 = 1 tương ứng với phương trình 2𝑥 + 1 = 0 và chạy lại đoạn code giải phương trình để xem kết quả.

go
	
CREATE PROC spud_GiaiPTBac1 @a float , @b float
AS
DECLARE @kq NVARCHAR(100)

IF(@a=0)
IF(@b=0)
SET @kq=N'Phương trình có vô  số nghiệm'
ELSE 
SET @kq=N'Phương trình  vô  nghiệm'
ELSE
SET @kq=N'Phương trình có nghiệm duy nhất x=' + CAST(-@b/@a AS CHAR(5))

PRINT @kq
GO
DECLARE @c float, @d float
SET @c=2
SET @d=1
EXEC spud_GiaiPTBac1 @c,@d